{"filePath":"examples/source/interactivity-dynamic-content/Favorite_Button/index.html","source":"<!--\n  ## Introduction\n\n  This sample demonstrates how to implement a favorite/like/bookmark button in AMP. Our implementation:\n\n  * shows the correct icon based on whether the user already liked an item or not. This works if the AMP is served\n  from an AMP Cache or the original origin.\n  * shows a placeholder while the current state is loaded asynchronously.\n  * falls back to the original state and displays an error message if the request fails, for example when the user is offline.\n--><!-- -->\n<!doctype html>\n<html âš¡>\n<head>\n<meta charset=\"utf-8\">\n    <title>Favorite Button</title>\n    <link rel=\"canonical\" href=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/index.html\">\n    <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1,initial-scale=1\">\n    <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n    <!-- ## Setup -->\n    <!-- We use the `amp-list` component to dynamically render the initial state of the favorite button. -->\n    <script async custom-element=\"amp-list\" src=\"https://cdn.ampproject.org/v0/amp-list-0.1.js\"></script>\n    <!-- The mustache component is required by `amp-list`.  -->\n    <script async custom-template=\"amp-mustache\" src=\"https://cdn.ampproject.org/v0/amp-mustache-0.2.js\"></script>\n    <!-- We need `amp-form` to submit the favorite request.  -->\n    <script async custom-element=\"amp-form\" src=\"https://cdn.ampproject.org/v0/amp-form-0.1.js\"></script>\n    <!-- `amp-bind` enables us to dynamically change the button state when we submit the form.  -->\n    <script async custom-element=\"amp-bind\" src=\"https://cdn.ampproject.org/v0/amp-bind-0.1.js\"></script>\n\n    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n    <style amp-custom>\n      :root {\n        --color-primary: #005AF0;\n        --color-text-light: #fff;\n        --color-bg-light: #FAFAFC;\n\n        --space-1: .5rem;  /* 8px */\n        --space-2: 1rem;   /* 16px */\n      }\n      /* some basic button styling */\n      .favorite-button input[type=submit] {\n        width: 48px;\n        height: 48px;\n        cursor: pointer;\n        border: none;\n        margin: 4px;\n        transition: background 300ms ease-in-out;\n      }\n      .favorite-button amp-list {\n        margin: var(--space-2);\n      }\n\n      .favorite-button .heart-fill {\n        background: url('data:image/svg+xml;utf8,<svg fill=\"%23000000\" height=\"48\" viewBox=\"0 0 24 24\" width=\"48\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z\"/></svg>');\n      }\n      .favorite-button .heart-border {\n        background: url('data:image/svg+xml;utf8,<svg fill=\"%23000000\" height=\"48\" viewBox=\"0 0 24 24\" width=\"48\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z\"/></svg>');\n      }\n      /* While the page loads we show a grey heart icon to indicate that the functionality is not yet available. */\n      .favorite-button .heart-loading,\n      .favorite-button .heart-loading[placeholder] {\n        background: url('data:image/svg+xml;utf8,<svg fill=\"%23cccccc\" height=\"48\" viewBox=\"0 0 24 24\" width=\"48\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z\"/></svg>');\n      }\n      .favorite-button .favorite-container {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      .favorite-button .favorite-count {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: var(--space-1);\n        margin-left: var(--space-1);\n        position: relative;\n        width: 48px;\n        background: var(--color-primary);\n        border-radius: .4em;\n        color: var(--color-text-light);\n      }\n      .favorite-button .favorite-count.loading {\n        color: #ccc;\n        background: var(--color-bg-light);\n      }\n      .favorite-button .favorite-count.loading:after {\n        border-right-color: var(--color-bg-light);\n      }\n      .favorite-button .favorite-count:after {\n        content: '';\n        position: absolute;\n        left: 0;\n        top: 50%;\n        width: 0;\n        height: 0;\n        border: var(--space-1) solid transparent;\n        border-right-color: var(--color-primary);\n        border-left: 0;\n        margin-top: calc(-1 * var(--space-1));\n        margin-left: calc(-1 * var(--space-1));\n      }\n      /* A simple snackbar to show an error */\n      #favorite-failed-message {\n        display: flex;\n        justify-content: space-between;\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        margin: 0 auto;\n        width: 100%;\n        max-width: 450px;\n        background: #323232;\n        color: white;\n        padding: 1rem 1.5rem;\n        z-index: 1000;\n      }\n      #favorite-failed-message div {\n        color: #64dd17;\n        margin: 0 1rem;\n        cursor: pointer;\n      }\n    </style>\n  </head>\n  <body>\n\n    <!--\n    ## Managing state\n\n    We initialize the button state from a JSON endpoint using `amp-state.` As we use cookies to identify the user, we need to add the `credentials=\"include\"`  attribute.\n    -->\n    <amp-state id=\"favorite\" credentials=\"include\" src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite\">\n    </amp-state>\n\n    <!--\n    ## A simple favorite button\n\n    The button is embedded inside an `amp-list`, which enables us to dynamically render the button based on whether\n    the user already liked something or not. Inside the template we use mustache's implicit iterator `.` to access the boolean\n    value that is returned by our `/favorite` endpoint: `{{#.}}heart-fill{{/.}}`.\n\n    We also declare a placeholder icon inside the `amp-list` using the `placeholder` attribute which\n    is shown while the `amp-list` is loading.\n\n    There are a few things that are happening when the user presses the favorite button:\n\n    * The form sends a toggle request when the user presses the button.\n    * We implement an optimistic UX that will instantly update the button state when the button is pressed.\n    * If the form submission fails (`submit-error:...`), we revert the\n    favorite state to the original version and show an error message (`favorite-failed-message.show`).\n    * We hide any existing error messages (`favorite-failed-message.hide`).\n    -->\n    <form class=\"favorite-button\" method=\"post\" action-xhr=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite\" target=\"_top\" on=\"submit:AMP.setState({\n                        favorite: !favorite\n                     }),\n                     favorite-failed-message.hide;\n              submit-error:AMP.setState({\n                        favorite: !favorite\n                     }),\n                     favorite-failed-message.show\">\n      <amp-list width=\"56\" height=\"56\" credentials=\"include\" items=\".\" single-item src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite\" binding=\"always\">\n        <template type=\"amp-mustache\">\n          <input type=\"submit\" class=\"{{#.}}heart-fill{{/.}}{{^.}}heart-border{{/.}}\" [class]=\"favorite ? 'heart-fill' : 'heart-border'\" value aria-label=\"Favorite Toggle\">\n        </template>\n        <div placeholder>\n          <input type=\"submit\" disabled class=\"heart-loading\" value aria-label=\"favorite placeholder\">\n        </div>\n      </amp-list>\n    </form>\n\n    <!-- A simple snackbar that we show when the form submission fails. -->\n    <div id=\"favorite-failed-message\" hidden>Error: Could not favorite.\n      <div on=\"tap:favorite-failed-message.hide\" tabindex=\"0\" role=\"button\">CLOSE</div>\n    </div>\n    <!--\n    ## A favorite button with counter\n\n    This is a more sophisticated version of the previous sample that also includes the number of favorites. Our [JSON endpoint](/favorite-with-count) returns two values: `value` and `count`.\n    -->\n    <amp-state id=\"favoriteWithCount\" credentials=\"include\" src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite-with-count\">\n    </amp-state>\n    <!--\n    The implementation is similar to the previous sample, but also updates the count when the button is clicked\n\n    ```javascript\n    AMP.setState({\n      ...,\n      count: favoriteWithCount.count + (favoriteWithCount.value ? -1 : 1)\n    })\n    ```\n\n    We use a temporary variable `previousFavoriteWithCount` to store the previous value in order to be able to revert the\n    button state in case the form submission fails.\n    -->\n    <form class=\"favorite-button\" method=\"post\" action-xhr=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite-with-count\" target=\"_top\" on=\"submit:AMP.setState({\n                   previousFavoriteWithCount: favoriteWithCount,\n                   favoriteWithCount: {\n                     value: !favoriteWithCount.value,\n                     count: favoriteWithCount.count + (favoriteWithCount.value ? -1 : 1),\n                   }\n                 }),\n                 favorite-failed-message.hide;\n             submit-error:AMP.setState({\n                   value: !favoriteWithCount.value,\n                   favoriteWithCount: previousFavoriteWithCount.count\n                 }),\n                 favorite-failed-message.show\">\n      <amp-list width=\"200\" height=\"56\" credentials=\"include\" items=\".\" single-item noloading src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite-with-count\" binding=\"always\">\n        <template type=\"amp-mustache\">\n          <div class=\"favorite-container\">\n            <input type=\"submit\" class=\"{{#value}}heart-fill{{/value}}{{^value}}heart-border{{/value}}\" [class]=\"favoriteWithCount.value ? 'heart-fill' : 'heart-border'\" value aria-label=\"Favorite Toggle\">\n            <div class=\"favorite-count\" [text]=\"favoriteWithCount.count ? favoriteWithCount.count : ''\">{{count}}</div>\n          </div>\n        </template>\n        <div placeholder>\n          <div class=\"favorite-container\">\n            <input type=\"submit\" disabled class=\"heart-loading\" value aria-label=\"favorite placeholder\">\n            <div class=\"favorite-count loading\">0</div>\n          </div>\n        </div>\n      </amp-list>\n    </form>\n</body></html>","document":{"sections":[{"doc_":"\n## Introduction\n\nThis sample demonstrates how to implement a favorite/like/bookmark button in AMP. Our implementation:\n\n* shows the correct icon based on whether the user already liked an item or not. This works if the AMP is served\nfrom an AMP Cache or the original origin.\n* shows a placeholder while the current state is loaded asynchronously.\n* falls back to the original state and displays an error message if the request fails, for example when the user is offline.\n\n","code":"","preview":"","inBody":false,"id":0,"cachedMarkedDoc":"<h2 id=\"introduction\" class=\"www-heading pb4 mb2 relative h3\">Introduction</h2><p class=\"mb2 px1\">This sample demonstrates how to implement a favorite/like/bookmark button in AMP. Our implementation:</p><ul>\n<li>shows the correct icon based on whether the user already liked an item or not. This works if the AMP is served\nfrom an AMP Cache or the original origin.</li>\n<li>shows a placeholder while the current state is loaded asynchronously.</li>\n<li>falls back to the original state and displays an error message if the request fails, for example when the user is offline.</li>\n</ul>\n","isLastSection":false,"isFirstSection":true,"commentOffset":0,"codeOffset":0,"headings":[{"id":"introduction","name":"Introduction"}],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\n## Introduction\n\nThis sample demonstrates how to implement a favorite/like/bookmark button in AMP. Our implementation:\n\n* shows the correct icon based on whether the user already liked an item or not. This works if the AMP is served\nfrom an AMP Cache or the original origin.\n* shows a placeholder while the current state is loaded asynchronously.\n* falls back to the original state and displays an error message if the request fails, for example when the user is offline.\n\n"},{"doc_":"\n","code":"<!doctype html>\n<html âš¡>\n<head>\n<meta charset=\"utf-8\">\n    <title>Favorite Button</title>\n    <link rel=\"canonical\" href=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/index.html\">\n    <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1,initial-scale=1\">\n    <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n","preview":"","inBody":false,"id":1,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":" \n"},{"doc_":"## Setup\n","code":"","preview":"","inBody":false,"id":2,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[{"id":"setup","name":"Setup"}],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"## Setup\n"},{"doc_":"We use the `amp-list` component to dynamically render the initial state of the favorite button. \n","code":"<script async custom-element=\"amp-list\" src=\"https://cdn.ampproject.org/v0/amp-list-0.1.js\"></script>\n","preview":"","inBody":false,"id":3,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":4,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"We use the `amp-list` component to dynamically render the initial state of the favorite button. \n"},{"doc_":"The mustache component is required by `amp-list`.  \n","code":"<script async custom-template=\"amp-mustache\" src=\"https://cdn.ampproject.org/v0/amp-mustache-0.2.js\"></script>\n","preview":"","inBody":false,"id":4,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":4,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"The mustache component is required by `amp-list`.  \n"},{"doc_":"We need `amp-form` to submit the favorite request.  \n","code":"<script async custom-element=\"amp-form\" src=\"https://cdn.ampproject.org/v0/amp-form-0.1.js\"></script>\n","preview":"","inBody":false,"id":5,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":4,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"We need `amp-form` to submit the favorite request.  \n"},{"doc_":"`amp-bind` enables us to dynamically change the button state when we submit the form.  \n","code":"<script async custom-element=\"amp-bind\" src=\"https://cdn.ampproject.org/v0/amp-bind-0.1.js\"></script>\n","preview":"","inBody":false,"id":6,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":4,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"`amp-bind` enables us to dynamically change the button state when we submit the form.  \n"},{"doc_":"","code":"\n    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n    <style amp-custom>\n      :root {\n        --color-primary: #005AF0;\n        --color-text-light: #fff;\n        --color-bg-light: #FAFAFC;\n\n        --space-1: .5rem;  /* 8px */\n        --space-2: 1rem;   /* 16px */\n      }\n      /* some basic button styling */\n      .favorite-button input[type=submit] {\n        width: 48px;\n        height: 48px;\n        cursor: pointer;\n        border: none;\n        margin: 4px;\n        transition: background 300ms ease-in-out;\n      }\n      .favorite-button amp-list {\n        margin: var(--space-2);\n      }\n\n      .favorite-button .heart-fill {\n        background: url('data:image/svg+xml;utf8,<svg fill=\"%23000000\" height=\"48\" viewBox=\"0 0 24 24\" width=\"48\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z\"/></svg>');\n      }\n      .favorite-button .heart-border {\n        background: url('data:image/svg+xml;utf8,<svg fill=\"%23000000\" height=\"48\" viewBox=\"0 0 24 24\" width=\"48\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z\"/></svg>');\n      }\n      /* While the page loads we show a grey heart icon to indicate that the functionality is not yet available. */\n      .favorite-button .heart-loading,\n      .favorite-button .heart-loading[placeholder] {\n        background: url('data:image/svg+xml;utf8,<svg fill=\"%23cccccc\" height=\"48\" viewBox=\"0 0 24 24\" width=\"48\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z\"/></svg>');\n      }\n      .favorite-button .favorite-container {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      .favorite-button .favorite-count {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: var(--space-1);\n        margin-left: var(--space-1);\n        position: relative;\n        width: 48px;\n        background: var(--color-primary);\n        border-radius: .4em;\n        color: var(--color-text-light);\n      }\n      .favorite-button .favorite-count.loading {\n        color: #ccc;\n        background: var(--color-bg-light);\n      }\n      .favorite-button .favorite-count.loading:after {\n        border-right-color: var(--color-bg-light);\n      }\n      .favorite-button .favorite-count:after {\n        content: '';\n        position: absolute;\n        left: 0;\n        top: 50%;\n        width: 0;\n        height: 0;\n        border: var(--space-1) solid transparent;\n        border-right-color: var(--color-primary);\n        border-left: 0;\n        margin-top: calc(-1 * var(--space-1));\n        margin-left: calc(-1 * var(--space-1));\n      }\n      /* A simple snackbar to show an error */\n      #favorite-failed-message {\n        display: flex;\n        justify-content: space-between;\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        margin: 0 auto;\n        width: 100%;\n        max-width: 450px;\n        background: #323232;\n        color: white;\n        padding: 1rem 1.5rem;\n        z-index: 1000;\n      }\n      #favorite-failed-message div {\n        color: #64dd17;\n        margin: 0 1rem;\n        cursor: pointer;\n      }\n    </style>\n  </head>\n<body>\n\n","preview":"\n","inBody":false,"id":7,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":""},{"doc_":"\n## Managing state\n\nWe initialize the button state from a JSON endpoint using `amp-state.` As we use cookies to identify the user, we need to add the `credentials=\"include\"`  attribute.\n\n","code":"<amp-state id=\"favorite\"\n  credentials=\"include\"\n  src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite\">\n</amp-state>\n","preview":"  <amp-state id=\"favorite\"\n    credentials=\"include\"\n    src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite\">\n  </amp-state>\n","inBody":true,"id":8,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[{"id":"managing-state","name":"Managing state"}],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\n## Managing state\n\nWe initialize the button state from a JSON endpoint using `amp-state.` As we use cookies to identify the user, we need to add the `credentials=\"include\"`  attribute.\n\n"},{"doc_":"","code":"\n","preview":"\n","inBody":true,"id":9,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":""},{"doc_":"\n## A simple favorite button\n\nThe button is embedded inside an `amp-list`, which enables us to dynamically render the button based on whether\nthe user already liked something or not. Inside the template we use mustache's implicit iterator `.` to access the boolean\nvalue that is returned by our `/favorite` endpoint: `{% raw %}{{#.}}{% endraw %}heart-fill{% raw %}{{/.}}{% endraw %}`.\n\nWe also declare a placeholder icon inside the `amp-list` using the `placeholder` attribute which\nis shown while the `amp-list` is loading.\n\nThere are a few things that are happening when the user presses the favorite button:\n\n* The form sends a toggle request when the user presses the button.\n* We implement an optimistic UX that will instantly update the button state when the button is pressed.\n* If the form submission fails (`submit-error:...`), we revert the\nfavorite state to the original version and show an error message (`favorite-failed-message.show`).\n* We hide any existing error messages (`favorite-failed-message.hide`).\n\n","code":"<form class=\"favorite-button\"\n  method=\"post\"\n  action-xhr=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite\"\n  target=\"_top\"\n  on=\"submit:AMP.setState({\n                      favorite: !favorite\n                   }),\n                   favorite-failed-message.hide;\n            submit-error:AMP.setState({\n                      favorite: !favorite\n                   }),\n                   favorite-failed-message.show\">\n  <amp-list width=\"56\"\n    height=\"56\"\n    credentials=\"include\"\n    items=\".\"\n    single-item\n    src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite\"\n    binding=\"always\">\n    <template type=\"amp-mustache\">\n      <input type=\"submit\"\n        class=\"{{#.}}heart-fill{{/.}}{{^.}}heart-border{{/.}}\"\n        [class]=\"favorite ? 'heart-fill' : 'heart-border'\"\n        value\n        aria-label=\"Favorite Toggle\">\n    </template>\n    <div placeholder>\n      <input type=\"submit\"\n        disabled\n        class=\"heart-loading\"\n        value\n        aria-label=\"favorite placeholder\">\n    </div>\n  </amp-list>\n</form>\n","preview":"  <form class=\"favorite-button\"\n    method=\"post\"\n    action-xhr=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite\"\n    target=\"_top\"\n    on=\"submit:AMP.setState({\n                        favorite: !favorite\n                     }),\n                     favorite-failed-message.hide;\n              submit-error:AMP.setState({\n                        favorite: !favorite\n                     }),\n                     favorite-failed-message.show\">\n    <amp-list width=\"56\"\n      height=\"56\"\n      credentials=\"include\"\n      items=\".\"\n      single-item\n      src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite\"\n      binding=\"always\">\n      <template type=\"amp-mustache\">\n        <input type=\"submit\"\n          class=\"{{#.}}heart-fill{{/.}}{{^.}}heart-border{{/.}}\"\n          [class]=\"favorite ? 'heart-fill' : 'heart-border'\"\n          value\n          aria-label=\"Favorite Toggle\">\n      </template>\n      <div placeholder>\n        <input type=\"submit\"\n          disabled\n          class=\"heart-loading\"\n          value\n          aria-label=\"favorite placeholder\">\n      </div>\n    </amp-list>\n  </form>\n","inBody":true,"id":10,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[{"id":"a-simple-favorite-button","name":"A simple favorite button"}],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\n## A simple favorite button\n\nThe button is embedded inside an `amp-list`, which enables us to dynamically render the button based on whether\nthe user already liked something or not. Inside the template we use mustache's implicit iterator `.` to access the boolean\nvalue that is returned by our `/favorite` endpoint: `{{#.}}heart-fill{{/.}}`.\n\nWe also declare a placeholder icon inside the `amp-list` using the `placeholder` attribute which\nis shown while the `amp-list` is loading.\n\nThere are a few things that are happening when the user presses the favorite button:\n\n* The form sends a toggle request when the user presses the button.\n* We implement an optimistic UX that will instantly update the button state when the button is pressed.\n* If the form submission fails (`submit-error:...`), we revert the\nfavorite state to the original version and show an error message (`favorite-failed-message.show`).\n* We hide any existing error messages (`favorite-failed-message.hide`).\n\n"},{"doc_":"","code":"\n","preview":"\n","inBody":true,"id":11,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":""},{"doc_":"A simple snackbar that we show when the form submission fails. \n","code":"<div id=\"favorite-failed-message\"\n  hidden>Error: Could not favorite.\n  <div on=\"tap:favorite-failed-message.hide\"\n    tabindex=\"0\"\n    role=\"button\">CLOSE</div>\n</div>\n","preview":"  <div id=\"favorite-failed-message\"\n    hidden>Error: Could not favorite.\n    <div on=\"tap:favorite-failed-message.hide\"\n      tabindex=\"0\"\n      role=\"button\">CLOSE</div>\n  </div>\n","inBody":true,"id":12,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"A simple snackbar that we show when the form submission fails. \n"},{"doc_":"\n## A favorite button with counter\n\nThis is a more sophisticated version of the previous sample that also includes the number of favorites. Our [JSON endpoint](/favorite-with-count) returns two values: `value` and `count`.\n\n","code":"<amp-state id=\"favoriteWithCount\"\n  credentials=\"include\"\n  src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite-with-count\">\n</amp-state>\n","preview":"  <amp-state id=\"favoriteWithCount\"\n    credentials=\"include\"\n    src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite-with-count\">\n  </amp-state>\n","inBody":true,"id":13,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[{"id":"a-favorite-button-with-counter","name":"A favorite button with counter"}],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\n## A favorite button with counter\n\nThis is a more sophisticated version of the previous sample that also includes the number of favorites. Our [JSON endpoint](/favorite-with-count) returns two values: `value` and `count`.\n\n"},{"doc_":"\nThe implementation is similar to the previous sample, but also updates the count when the button is clicked\n\n[sourcecode:javascript]\nAMP.setState({\n  ...,\n  count: favoriteWithCount.count + (favoriteWithCount.value ? -1 : 1)\n})\n[/sourcecode]\n\nWe use a temporary variable `previousFavoriteWithCount` to store the previous value in order to be able to revert the\nbutton state in case the form submission fails.\n\n","code":"<form class=\"favorite-button\"\n  method=\"post\"\n  action-xhr=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite-with-count\"\n  target=\"_top\"\n  on=\"submit:AMP.setState({\n                 previousFavoriteWithCount: favoriteWithCount,\n                 favoriteWithCount: {\n                   value: !favoriteWithCount.value,\n                   count: favoriteWithCount.count + (favoriteWithCount.value ? -1 : 1),\n                 }\n               }),\n               favorite-failed-message.hide;\n           submit-error:AMP.setState({\n                 value: !favoriteWithCount.value,\n                 favoriteWithCount: previousFavoriteWithCount.count\n               }),\n               favorite-failed-message.show\">\n  <amp-list width=\"200\"\n    height=\"56\"\n    credentials=\"include\"\n    items=\".\"\n    single-item\n    noloading\n    src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite-with-count\"\n    binding=\"always\">\n    <template type=\"amp-mustache\">\n      <div class=\"favorite-container\">\n        <input type=\"submit\"\n          class=\"{{#value}}heart-fill{{/value}}{{^value}}heart-border{{/value}}\"\n          [class]=\"favoriteWithCount.value ? 'heart-fill' : 'heart-border'\"\n          value\n          aria-label=\"Favorite Toggle\">\n        <div class=\"favorite-count\"\n          [text]=\"favoriteWithCount.count ? favoriteWithCount.count : ''\">{{count}}</div>\n      </div>\n    </template>\n    <div placeholder>\n      <div class=\"favorite-container\">\n        <input type=\"submit\"\n          disabled\n          class=\"heart-loading\"\n          value\n          aria-label=\"favorite placeholder\">\n        <div class=\"favorite-count loading\">0</div>\n      </div>\n    </div>\n  </amp-list>\n</form>\n","preview":"  <form class=\"favorite-button\"\n    method=\"post\"\n    action-xhr=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite-with-count\"\n    target=\"_top\"\n    on=\"submit:AMP.setState({\n                   previousFavoriteWithCount: favoriteWithCount,\n                   favoriteWithCount: {\n                     value: !favoriteWithCount.value,\n                     count: favoriteWithCount.count + (favoriteWithCount.value ? -1 : 1),\n                   }\n                 }),\n                 favorite-failed-message.hide;\n             submit-error:AMP.setState({\n                   value: !favoriteWithCount.value,\n                   favoriteWithCount: previousFavoriteWithCount.count\n                 }),\n                 favorite-failed-message.show\">\n    <amp-list width=\"200\"\n      height=\"56\"\n      credentials=\"include\"\n      items=\".\"\n      single-item\n      noloading\n      src=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/favorite-with-count\"\n      binding=\"always\">\n      <template type=\"amp-mustache\">\n        <div class=\"favorite-container\">\n          <input type=\"submit\"\n            class=\"{{#value}}heart-fill{{/value}}{{^value}}heart-border{{/value}}\"\n            [class]=\"favoriteWithCount.value ? 'heart-fill' : 'heart-border'\"\n            value\n            aria-label=\"Favorite Toggle\">\n          <div class=\"favorite-count\"\n            [text]=\"favoriteWithCount.count ? favoriteWithCount.count : ''\">{{count}}</div>\n        </div>\n      </template>\n      <div placeholder>\n        <div class=\"favorite-container\">\n          <input type=\"submit\"\n            disabled\n            class=\"heart-loading\"\n            value\n            aria-label=\"favorite placeholder\">\n          <div class=\"favorite-count loading\">0</div>\n        </div>\n      </div>\n    </amp-list>\n  </form>\n","inBody":true,"id":14,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\nThe implementation is similar to the previous sample, but also updates the count when the button is clicked\n\n```javascript\nAMP.setState({\n  ...,\n  count: favoriteWithCount.count + (favoriteWithCount.value ? -1 : 1)\n})\n```\n\nWe use a temporary variable `previousFavoriteWithCount` to store the previous value in order to be able to revert the\nbutton state in case the form submission fails.\n\n"},{"doc_":"","code":"</body>\n</html>\n","preview":"","inBody":false,"id":15,"cachedMarkedDoc":false,"isLastSection":true,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":""}],"head":"<meta charset=\"utf-8\">\n    <title>Favorite Button</title>\n    <link rel=\"canonical\" href=\"http://localhost:8080/documentation/examples/interactivity-dynamic-content/favorite_button/index.html\">\n    <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1,initial-scale=1\">\n    <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n    <script async custom-element=\"amp-list\" src=\"https://cdn.ampproject.org/v0/amp-list-0.1.js\"></script>\n    <script async custom-template=\"amp-mustache\" src=\"https://cdn.ampproject.org/v0/amp-mustache-0.2.js\"></script>\n    <script async custom-element=\"amp-form\" src=\"https://cdn.ampproject.org/v0/amp-form-0.1.js\"></script>\n    <script async custom-element=\"amp-bind\" src=\"https://cdn.ampproject.org/v0/amp-bind-0.1.js\"></script>\n\n    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n","styles":"      :root {\n        --color-primary: #005AF0;\n        --color-text-light: #fff;\n        --color-bg-light: #FAFAFC;\n\n        --space-1: .5rem;  /* 8px */\n        --space-2: 1rem;   /* 16px */\n      }\n      /* some basic button styling */\n      .favorite-button input[type=submit] {\n        width: 48px;\n        height: 48px;\n        cursor: pointer;\n        border: none;\n        margin: 4px;\n        transition: background 300ms ease-in-out;\n      }\n      .favorite-button amp-list {\n        margin: var(--space-2);\n      }\n\n      .favorite-button .heart-fill {\n        background: url('data:image/svg+xml;utf8,<svg fill=\"%23000000\" height=\"48\" viewBox=\"0 0 24 24\" width=\"48\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z\"/></svg>');\n      }\n      .favorite-button .heart-border {\n        background: url('data:image/svg+xml;utf8,<svg fill=\"%23000000\" height=\"48\" viewBox=\"0 0 24 24\" width=\"48\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z\"/></svg>');\n      }\n      /* While the page loads we show a grey heart icon to indicate that the functionality is not yet available. */\n      .favorite-button .heart-loading,\n      .favorite-button .heart-loading[placeholder] {\n        background: url('data:image/svg+xml;utf8,<svg fill=\"%23cccccc\" height=\"48\" viewBox=\"0 0 24 24\" width=\"48\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M0 0h24v24H0z\" fill=\"none\"/><path d=\"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z\"/></svg>');\n      }\n      .favorite-button .favorite-container {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n      .favorite-button .favorite-count {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        padding: var(--space-1);\n        margin-left: var(--space-1);\n        position: relative;\n        width: 48px;\n        background: var(--color-primary);\n        border-radius: .4em;\n        color: var(--color-text-light);\n      }\n      .favorite-button .favorite-count.loading {\n        color: #ccc;\n        background: var(--color-bg-light);\n      }\n      .favorite-button .favorite-count.loading:after {\n        border-right-color: var(--color-bg-light);\n      }\n      .favorite-button .favorite-count:after {\n        content: '';\n        position: absolute;\n        left: 0;\n        top: 50%;\n        width: 0;\n        height: 0;\n        border: var(--space-1) solid transparent;\n        border-right-color: var(--color-primary);\n        border-left: 0;\n        margin-top: calc(-1 * var(--space-1));\n        margin-left: calc(-1 * var(--space-1));\n      }\n      /* A simple snackbar to show an error */\n      #favorite-failed-message {\n        display: flex;\n        justify-content: space-between;\n        position: fixed;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        margin: 0 auto;\n        width: 100%;\n        max-width: 450px;\n        background: #323232;\n        color: white;\n        padding: 1rem 1.5rem;\n        z-index: 1000;\n      }\n      #favorite-failed-message div {\n        color: #64dd17;\n        margin: 0 1rem;\n        cursor: pointer;\n      }\n","title":"Favorite Button","metadata":{"teaserImage":"/static/samples/img/teaser/favorite_button.jpg","author":"sebastianbenz"},"body":"<body>","elementsAfterBody":"","isAmpStory":false,"isAmpWeb":true,"isAmpAds":false,"isAmpEmail":false,"firstImage":"/favicons/android-chrome-256x256.png","lang":"en","_description":"This sample demonstrates how to implement a favorite/like/bookmark button in AMP."},"route":"/documentation/examples/interactivity-dynamic-content/favorite_button/index.html"}