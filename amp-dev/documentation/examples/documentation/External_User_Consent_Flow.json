{"filePath":"examples/source/user-consent/External_User_Consent_Flow.html","source":"<!--\n  ## Introduction\n\n  Sometimes publishers want to collect user consent using external prompt UI flow with iframes. This sample demonstrates how you can use `amp-consent` together with `amp-iframe` to achieve this. In this sample we'll build a consent dialog from an iframe.\n--><!-- -->\n<!doctype html>\n<html ⚡>\n<head>\n<meta charset=\"utf-8\">\n  <link rel=\"canonical\" href=\"http://localhost:8080/documentation/examples/user-consent/external_user_consent_flow/index.html\">\n  <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1,initial-scale=1\">\n  <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n  <title>External User Consent Flow</title>\n  <!-- ## Setup -->\n  <!--\n  We need to import both, the `amp-consent` ...\n  -->\n  <script async custom-element=\"amp-consent\" src=\"https://cdn.ampproject.org/v0/amp-consent-0.1.js\"></script>\n\n  <!--\n  ... and the `amp-iframe` extension.\n  -->\n  <script async custom-element=\"amp-iframe\" src=\"https://cdn.ampproject.org/v0/amp-iframe-0.1.js\"></script>\n  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n  <style amp-custom>\n    :root {\n      --space-3: 1.5rem; /* 24px */\n    }\n    .consentPopup {\n      padding: var(--space-3);\n      margin: 0 auto;\n      background: #fff;\n      position: relative;\n      max-width: 700px;\n      width: 95%;\n      width: 65vw;\n      height: 65vh;\n    }\n    .popupOverlay {\n      height: 100vh;\n      width: 100vw;\n      background: rgba(0, 0, 0, 0.7);\n      padding: 5% 0;\n    }\n    #post-consent-ui {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      padding: var(--space-3);\n    }\n    .consentPopup amp-iframe {\n      border-radius: 5px;\n    }\n  </style>\n</head>\n<body>\n  <!-- ## Defining the Consent Flow -->\n  <!--\n    We define a basic consent flow, similar to [this sample](/user_consent/basic_user_consent_flow/). The consent dialog is from a CORS iframe loaded with the `amp-iframe` component\n  -->\n  <amp-consent id=\"myUserConsent\" layout=\"nodisplay\">\n    <script type=\"application/json\">{\n      \"consentInstanceId\": \"iframe-consent\",\n      \"checkConsent\": \"remote\",\n      \"checkConsentHref\": \"/documentation/examples/api/get-consent\",\n      \"promptUI\": \"myConsentFlow\",\n      \"postPromptUI\": \"post-consent-ui\"\n    }</script>\n    <div id=\"myConsentFlow\" class=\"popupOverlay\">\n      <div class=\"consentPopup\">\n        <amp-iframe layout=\"fill\" sandbox=\"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox\" src=\"https://amp-by-example-api.appspot.com/iframe/external-consent-iframe.html\">\n            <div placeholder>Loading</div>\n        </amp-iframe>\n      </div>\n    </div>\n    <div id=\"post-consent-ui\">\n      <button on=\"tap:myUserConsent.prompt()\">Update Consent</button>\n    </div>\n  </amp-consent>\n\n  <!-- ## Consent Dialog Iframe -->\n  <!--\n    The consent dialog iframe can inform  the `amp-consent` component user's choice through postMessages.\n\n    ```js\n    window.parent.postMessage({\n      type: 'consent-response',\n      action: 'accept'\n    }, '*');\n    ```\n\n    Here action can be either `'accept'`, `'reject'` or `'dismiss'`.\n  -->\n\n    <!--\n    Use `data-block-on-consent` attribute to block AMP components until consent is given.\n    Individual AMP components can override  blocking behavior and implement blocking logic themselves.\n\n    Here is an image which is blocked until consent is given:\n  -->\n  <amp-img data-block-on-consent src=\"/static/samples/img/landscape_lake_300x201.jpg\" width=\"300\" height=\"201\">\n  </amp-img>\n</body></html>","document":{"sections":[{"doc_":"\n## Introduction\n\nSometimes publishers want to collect user consent using external prompt UI flow with iframes. This sample demonstrates how you can use `amp-consent` together with `amp-iframe` to achieve this. In this sample we'll build a consent dialog from an iframe.\n\n","code":"","preview":"","inBody":false,"id":0,"cachedMarkedDoc":"<h2 id=\"introduction\" class=\"www-heading pb4 mb2 relative h3\">Introduction</h2><p class=\"mb2 px1\">Sometimes publishers want to collect user consent using external prompt UI flow with iframes. This sample demonstrates how you can use <code>amp-consent</code> together with <code>amp-iframe</code> to achieve this. In this sample we&#39;ll build a consent dialog from an iframe.</p>","isLastSection":false,"isFirstSection":true,"commentOffset":0,"codeOffset":0,"headings":[{"id":"introduction","name":"Introduction"}],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\n## Introduction\n\nSometimes publishers want to collect user consent using external prompt UI flow with iframes. This sample demonstrates how you can use `amp-consent` together with `amp-iframe` to achieve this. In this sample we'll build a consent dialog from an iframe.\n\n"},{"doc_":"\n","code":"<!doctype html>\n<html ⚡>\n<head>\n<meta charset=\"utf-8\">\n  <link rel=\"canonical\" href=\"http://localhost:8080/documentation/examples/user-consent/external_user_consent_flow/index.html\">\n  <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1,initial-scale=1\">\n  <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n  <title>External User Consent Flow</title>\n","preview":"","inBody":false,"id":1,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":" \n"},{"doc_":"## Setup\n","code":"","preview":"","inBody":false,"id":2,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[{"id":"setup","name":"Setup"}],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"## Setup\n"},{"doc_":"\nWe need to import both, the `amp-consent` ...\n\n","code":"<script async custom-element=\"amp-consent\" src=\"https://cdn.ampproject.org/v0/amp-consent-0.1.js\"></script>\n","preview":"","inBody":false,"id":3,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\nWe need to import both, the `amp-consent` ...\n\n"},{"doc_":"","code":"\n","preview":"","inBody":false,"id":4,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":""},{"doc_":"\n... and the `amp-iframe` extension.\n\n","code":"<script async custom-element=\"amp-iframe\" src=\"https://cdn.ampproject.org/v0/amp-iframe-0.1.js\"></script>\n","preview":"","inBody":false,"id":5,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\n... and the `amp-iframe` extension.\n\n"},{"doc_":"","code":"<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n<style amp-custom>\n  :root {\n    --space-3: 1.5rem; /* 24px */\n  }\n  .consentPopup {\n    padding: var(--space-3);\n    margin: 0 auto;\n    background: #fff;\n    position: relative;\n    max-width: 700px;\n    width: 95%;\n    width: 65vw;\n    height: 65vh;\n  }\n  .popupOverlay {\n    height: 100vh;\n    width: 100vw;\n    background: rgba(0, 0, 0, 0.7);\n    padding: 5% 0;\n  }\n  #post-consent-ui {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: var(--space-3);\n  }\n  .consentPopup amp-iframe {\n    border-radius: 5px;\n  }\n</style>\n</head>\n<body>\n","preview":"","inBody":false,"id":6,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":""},{"doc_":"## Defining the Consent Flow\n","code":"","preview":"","inBody":true,"id":7,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[{"id":"defining-the-consent-flow","name":"Defining the Consent Flow"}],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"## Defining the Consent Flow\n"},{"doc_":"\nWe define a basic consent flow, similar to [this sample](/user_consent/basic_user_consent_flow/). The consent dialog is from a CORS iframe loaded with the `amp-iframe` component\n\n","code":"<amp-consent id=\"myUserConsent\"\n  layout=\"nodisplay\">\n  <script type=\"application/json\">\n    {\n      \"consentInstanceId\": \"iframe-consent\",\n      \"checkConsent\": \"remote\",\n      \"checkConsentHref\": \"/documentation/examples/api/get-consent\",\n      \"promptUI\": \"myConsentFlow\",\n      \"postPromptUI\": \"post-consent-ui\"\n    }\n  </script>\n  <div id=\"myConsentFlow\"\n    class=\"popupOverlay\">\n    <div class=\"consentPopup\">\n      <amp-iframe layout=\"fill\"\n        sandbox=\"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox\"\n        src=\"https://amp-by-example-api.appspot.com/iframe/external-consent-iframe.html\">\n        <div placeholder>Loading</div>\n      </amp-iframe>\n    </div>\n  </div>\n  <div id=\"post-consent-ui\">\n    <button on=\"tap:myUserConsent.prompt()\">Update Consent</button>\n  </div>\n</amp-consent>\n","preview":"  <amp-consent id=\"myUserConsent\"\n    layout=\"nodisplay\">\n    <script type=\"application/json\">\n      {\n        \"consentInstanceId\": \"iframe-consent\",\n        \"checkConsent\": \"remote\",\n        \"checkConsentHref\": \"/documentation/examples/api/get-consent\",\n        \"promptUI\": \"myConsentFlow\",\n        \"postPromptUI\": \"post-consent-ui\"\n      }\n    </script>\n    <div id=\"myConsentFlow\"\n      class=\"popupOverlay\">\n      <div class=\"consentPopup\">\n        <amp-iframe layout=\"fill\"\n          sandbox=\"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox\"\n          src=\"https://amp-by-example-api.appspot.com/iframe/external-consent-iframe.html\">\n          <div placeholder>Loading</div>\n        </amp-iframe>\n      </div>\n    </div>\n    <div id=\"post-consent-ui\">\n      <button on=\"tap:myUserConsent.prompt()\">Update Consent</button>\n    </div>\n  </amp-consent>\n","inBody":true,"id":8,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\nWe define a basic consent flow, similar to [this sample](/user_consent/basic_user_consent_flow/). The consent dialog is from a CORS iframe loaded with the `amp-iframe` component\n\n"},{"doc_":"","code":"\n","preview":"\n","inBody":true,"id":9,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":""},{"doc_":"## Consent Dialog Iframe\n","code":"","preview":"","inBody":true,"id":10,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[{"id":"consent-dialog-iframe","name":"Consent Dialog Iframe"}],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"## Consent Dialog Iframe\n"},{"doc_":"\nThe consent dialog iframe can inform  the `amp-consent` component user's choice through postMessages.\n\n[sourcecode:js]\nwindow.parent.postMessage({\n  type: 'consent-response',\n  action: 'accept'\n}, '*');\n[/sourcecode]\n\nHere action can be either `'accept'`, `'reject'` or `'dismiss'`.\n\n","code":"\n","preview":"\n","inBody":true,"id":11,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\nThe consent dialog iframe can inform  the `amp-consent` component user's choice through postMessages.\n\n```js\nwindow.parent.postMessage({\n  type: 'consent-response',\n  action: 'accept'\n}, '*');\n```\n\nHere action can be either `'accept'`, `'reject'` or `'dismiss'`.\n\n"},{"doc_":"\nUse `data-block-on-consent` attribute to block AMP components until consent is given.\nIndividual AMP components can override  blocking behavior and implement blocking logic themselves.\n\nHere is an image which is blocked until consent is given:\n\n","code":"<amp-img data-block-on-consent\n  src=\"/static/samples/img/landscape_lake_300x201.jpg\"\n  width=\"300\"\n  height=\"201\">\n</amp-img>\n","preview":"  <amp-img data-block-on-consent\n    src=\"/static/samples/img/landscape_lake_300x201.jpg\"\n    width=\"300\"\n    height=\"201\">\n  </amp-img>\n","inBody":true,"id":12,"cachedMarkedDoc":false,"isLastSection":false,"isFirstSection":false,"commentOffset":0,"codeOffset":2,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":"\nUse `data-block-on-consent` attribute to block AMP components until consent is given.\nIndividual AMP components can override  blocking behavior and implement blocking logic themselves.\n\nHere is an image which is blocked until consent is given:\n\n"},{"doc_":"","code":"</body>\n</html>\n","preview":"","inBody":false,"id":13,"cachedMarkedDoc":false,"isLastSection":true,"isFirstSection":false,"commentOffset":0,"codeOffset":0,"headings":[],"storyPageId":"","currentHint":"","hints":[],"filters":null,"normalizedDoc_":""}],"head":"<meta charset=\"utf-8\">\n  <link rel=\"canonical\" href=\"http://localhost:8080/documentation/examples/user-consent/external_user_consent_flow/index.html\">\n  <meta name=\"viewport\" content=\"width=device-width,minimum-scale=1,initial-scale=1\">\n  <script async src=\"https://cdn.ampproject.org/v0.js\"></script>\n  <title>External User Consent Flow</title>\n  <script async custom-element=\"amp-consent\" src=\"https://cdn.ampproject.org/v0/amp-consent-0.1.js\"></script>\n\n  <script async custom-element=\"amp-iframe\" src=\"https://cdn.ampproject.org/v0/amp-iframe-0.1.js\"></script>\n  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>\n","styles":"    :root {\n      --space-3: 1.5rem; /* 24px */\n    }\n    .consentPopup {\n      padding: var(--space-3);\n      margin: 0 auto;\n      background: #fff;\n      position: relative;\n      max-width: 700px;\n      width: 95%;\n      width: 65vw;\n      height: 65vh;\n    }\n    .popupOverlay {\n      height: 100vh;\n      width: 100vw;\n      background: rgba(0, 0, 0, 0.7);\n      padding: 5% 0;\n    }\n    #post-consent-ui {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      padding: var(--space-3);\n    }\n    .consentPopup amp-iframe {\n      border-radius: 5px;\n    }\n","title":"External User Consent Flow","metadata":{"teaserImage":"/static/samples/img/teaser/external_user_consentflow.jpg","author":"zhouyx"},"body":"<body>","elementsAfterBody":"","isAmpStory":false,"isAmpWeb":true,"isAmpAds":false,"isAmpEmail":false,"firstImage":"/favicons/android-chrome-256x256.png","lang":"en","_description":"Sometimes publishers want to collect user consent using external prompt UI flow with iframes."},"route":"/documentation/examples/user-consent/external_user_consent_flow/index.html"}